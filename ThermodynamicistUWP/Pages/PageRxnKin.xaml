<Page
	x:Class="ThermodynamicistUWP.PageRxnKin"
	xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
	xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
	xmlns:ctk="using:CommunityToolkit.WinUI"
	xmlns:animate="using:Microsoft.UI.Xaml.Controls.AnimatedVisuals"
	xmlns:local="using:ThermodynamicistUWP"
	xmlns:vm="using:Core.ViewModels"
	xmlns:rl="using:Core.Reactions.Kinetics"
	xmlns:muxc="using:Microsoft.UI.Xaml.Controls"
	xmlns:oxy="using:OxyPlot.Windows"
	
	xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
	xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
	mc:Ignorable="d"
	Background="{ThemeResource ApplicationPageBackgroundThemeBrush}"
	NavigationCacheMode="Required">

	<Page.Resources>
		<DataTemplate x:Key="ListOutputSelectionTemplate" x:DataType="vm:RxnKinOutputItem">
			<ListViewItem AutomationProperties.Name="{x:Bind Name}">
				<StackPanel Orientation="Horizontal">
					<FontIcon Width="20" Glyph="{x:Bind Glyph}"/>
					<TextBlock Text="{x:Bind Name}" Margin="5"/>
				</StackPanel>
			</ListViewItem>
		</DataTemplate>
	</Page.Resources>


	<Grid Margin="10">
		<Grid.ColumnDefinitions>
			<ColumnDefinition Width="320"/>
			<ColumnDefinition Width="*"/>
		</Grid.ColumnDefinitions>
		<Grid.RowDefinitions>
			<RowDefinition Height="400"/>
			<RowDefinition Height="Auto"/>
			<RowDefinition Height="*"/>
		</Grid.RowDefinitions>

		<VisualStateManager.VisualStateGroups>
			<VisualStateGroup x:Name="VisState_RateLaw">
				<VisualState x:Name="VisState_RateLaw_NotNull"/>
				<VisualState x:Name="VisState_RateLaw_Empty">
					<VisualState.StateTriggers>
						<ctk:IsNullOrEmptyStateTrigger Value="{x:Bind ViewModel.RateLawFactory, Mode=OneWay}"/>
					</VisualState.StateTriggers>
					<VisualState.Setters>
						<Setter Target="DropdownRateLaw.BorderBrush" Value="{StaticResource SystemFillColorCriticalBrush}"/>
					</VisualState.Setters>
				</VisualState>
			</VisualStateGroup>
			<VisualStateGroup x:Name="VisState_T">
				<VisualState x:Name="VisState_T_NotNull"/>
				<VisualState x:Name="VisState_T_Empty">
					<VisualState.StateTriggers>
						<ctk:CompareStateTrigger Comparison="Equal" To="NaN" Value="{x:Bind NumBoxT.Value, Mode=OneWay}"/>
						<ctk:CompareStateTrigger Comparison="Equal" To="0" Value="{x:Bind NumBoxT.Value, Mode=OneWay}"/>
					</VisualState.StateTriggers>
					<VisualState.Setters>
						<Setter Target="NumBoxT.BorderBrush" Value="{StaticResource SystemFillColorCriticalBrush}"/>
					</VisualState.Setters>
				</VisualState>
			</VisualStateGroup>
			<VisualStateGroup x:Name="VisState_P">
				<VisualState x:Name="VisState_P_NotNull"/>
				<VisualState x:Name="VisState_P_Empty">
					<VisualState.StateTriggers>
						<ctk:CompareStateTrigger Comparison="Equal" To="NaN" Value="{x:Bind NumBoxP.Value, Mode=OneWay}"/>
						<ctk:CompareStateTrigger Comparison="Equal" To="0" Value="{x:Bind NumBoxP.Value, Mode=OneWay}"/>
					</VisualState.StateTriggers>
					<VisualState.Setters>
						<Setter Target="NumBoxP.BorderBrush" Value="{StaticResource SystemFillColorCriticalBrush}"/>
					</VisualState.Setters>
				</VisualState>
			</VisualStateGroup>
			<VisualStateGroup x:Name="VisState_FrequencyFactor">
				<VisualState x:Name="VisState_FrequencyFactor_NotNull"/>
				<VisualState x:Name="VisState_FrequencyFactor_Empty">
					<VisualState.StateTriggers>
						<ctk:CompareStateTrigger Comparison="Equal" To="NaN" Value="{x:Bind NumBoxFrequencyFactor.Value, Mode=OneWay}"/>
					</VisualState.StateTriggers>
					<VisualState.Setters>
						<Setter Target="NumBoxFrequencyFactor.BorderBrush" Value="{StaticResource SystemFillColorCriticalBrush}"/>
					</VisualState.Setters>
				</VisualState>
			</VisualStateGroup>
			<VisualStateGroup x:Name="VisState_ActivationEnergy">
				<VisualState x:Name="VisState_ActivationEnergy_NotNull"/>
				<VisualState x:Name="VisState_ActivationEnergy_Empty">
					<VisualState.StateTriggers>
						<ctk:CompareStateTrigger Comparison="Equal" To="NaN" Value="{x:Bind NumBoxActivationEnergy.Value, Mode=OneWay}"/>
					</VisualState.StateTriggers>
					<VisualState.Setters>
						<Setter Target="NumBoxActivationEnergy.BorderBrush" Value="{StaticResource SystemFillColorCriticalBrush}"/>
					</VisualState.Setters>
				</VisualState>
			</VisualStateGroup>
			<VisualStateGroup x:Name="VisState_SpeciesList">
				<VisualState x:Name="VisState_SpeciesList_NotNull"/>
				<VisualState x:Name="VisState_SpeciesList_Empty">
					<VisualState.StateTriggers>
						<ctk:IsNullOrEmptyStateTrigger Value="{x:Bind ViewModel.Items, Mode=OneWay}"/>
					</VisualState.StateTriggers>
					<VisualState.Setters>
						<Setter Target="InfoBarNoRxnSpecies.IsOpen" Value="True"/>
						<Setter Target="ButtonAddSpecies.Background" Value="{StaticResource SystemFillColorCautionBackgroundBrush}"/>
						<Setter Target="ButtonAddSpecies.BorderBrush" Value="{StaticResource SystemFillColorCautionBrush}"/>
					</VisualState.Setters>
				</VisualState>
			</VisualStateGroup>
			<VisualStateGroup x:Name="VisState_OutputSelection">
				<VisualState x:Name="VisState_OutputSelection_NotNull"/>
				<VisualState x:Name="VisState_OutputSelection_Empty">
					<VisualState.StateTriggers>
						<ctk:IsNullOrEmptyStateTrigger Value="{x:Bind ViewModel.SelectedOutputOptions, Mode=OneWay}"/>
					</VisualState.StateTriggers>
					<VisualState.Setters>
						<Setter Target="InfoBarNoOutputsSelected.IsOpen" Value="True"/>
						<Setter Target="ButtonSelectOutputItems.Background" Value="{StaticResource SystemFillColorCautionBackgroundBrush}"/>
						<Setter Target="ButtonSelectOutputItems.BorderBrush" Value="{StaticResource SystemFillColorCautionBrush}"/>
					</VisualState.Setters>
				</VisualState>
			</VisualStateGroup>
		</VisualStateManager.VisualStateGroups>

		<StackPanel Orientation="Vertical" Grid.Row="0" Grid.Column="0" VerticalAlignment="Top">
			<!--
			Initialize : See attached .cs file. Rate laws must be added manually using their RateLawFactories.
			Selection  : Bound to ViewModel.RateLawFactory, notably not a RateLaw directly.
			TextBlock  : Bound to RateLawFactory.Name which contains the human-readable name for the rate law.
			Note : Binding to RateLawFactory removes the need to pass around a specific rate law instance and is more like the *concept* of a rate law.
			-->
			<ComboBox x:Name="DropdownRateLaw" Header="Rate law:" PlaceholderText="Pick a rate law"
					SelectedValue="{x:Bind ViewModel.RateLawFactory, Mode=TwoWay}"
					Margin="5" Grid.Row="1" Grid.ColumnSpan="3" Width="225">
				<ComboBox.ItemTemplate>
					<DataTemplate x:DataType="rl:IRateLawFactory">
						<TextBlock Text="{x:Bind Name}"/>
					</DataTemplate>
				</ComboBox.ItemTemplate>
			</ComboBox>
				
			<muxc:NumberBox x:Name="NumBoxT" Header="Temperature:" PlaceholderText="[K]" Margin="5" Width="150" MaxHeight="60"
							Value="{x:Bind ViewModel.T, Mode=TwoWay}" AcceptsExpression="True" HorizontalAlignment="Left"/>
			<muxc:NumberBox x:Name="NumBoxP" Header="Pressure:" PlaceholderText="[Pa]" Margin="5" Width="150" MaxHeight="60"
							Value="{x:Bind ViewModel.P, Mode=TwoWay}" AcceptsExpression="True" HorizontalAlignment="Left"/>
			<muxc:NumberBox x:Name="NumBoxFrequencyFactor" Header="Frequency factor:" PlaceholderText="[1]"
							Value="{x:Bind ViewModel.FrequencyFactor, Mode=TwoWay}" AcceptsExpression="True" Margin="5" Width="150" MaxHeight="60" HorizontalAlignment="Left"/>
			<muxc:NumberBox x:Name="NumBoxActivationEnergy" Header="Activation energy: " PlaceholderText="[J/mol]"
							Value="{x:Bind ViewModel.ActivationEnergy, Mode=TwoWay}" AcceptsExpression="True" Margin="5" Width="150" MaxHeight="60" HorizontalAlignment="Left"/>

			<StackPanel Orientation="Horizontal">
				<Button x:Name="ButtonSelectOutputItems" Margin="5" Click="ButtonSelectOutputItems_Click">
					<muxc:AnimatedIcon x:Name="AniIconButtonSelectOutputItems" Width="20">
						<muxc:AnimatedIcon.Source>
							<animate:AnimatedSettingsVisualSource/>
						</muxc:AnimatedIcon.Source>
						<muxc:AnimatedIcon.FallbackIconSource>
							<muxc:SymbolIconSource Symbol="Setting"/>
						</muxc:AnimatedIcon.FallbackIconSource>
					</muxc:AnimatedIcon>
				</Button>
				<Popup x:Name="PopupSelectOutputItems" IsLightDismissEnabled="True" Width="Auto">
					<Popup.ChildTransitions>
						<TransitionCollection>
							<PopupThemeTransition/>
						</TransitionCollection>
					</Popup.ChildTransitions>
					<Border Padding="15" CornerRadius="{StaticResource OverlayCornerRadius}"
							BorderThickness="1" BorderBrush="{ThemeResource SurfaceStrokeColorDefaultBrush}"
							Background="{ThemeResource AcrylicBackgroundFillColorDefaultBrush}">
						<StackPanel Orientation="Horizontal">
							<!--
							Source : Bound to ViewModel.AvailableOutputOptions, which is of type List<RxnOutputOptions>.
							-->
							<StackPanel Orientation="Vertical">
								<TextBlock Text="Available outputs" Margin="0,0,0,0" Style="{ThemeResource SubtitleTextBlockStyle}"/>
								<ListView x:Name="ListOutputItems_Left" Width="270" Padding="0" Margin="0"
										  ItemTemplate="{StaticResource ListOutputSelectionTemplate}"
										  ItemsSource="{x:Bind ViewModel.AvailableOutputOptions}"
										  CanDragItems="True" CanReorderItems="True" AllowDrop="True" SelectionMode="Extended">
								</ListView>
							</StackPanel>
							
							<StackPanel VerticalAlignment="Stretch" Spacing="5" Margin="0,0,5,0">
								<!--
								Click : Runs ButtonAddOutputItem_Click, which moves any selected items to ViewModel.SelectedOutputOptions
								-->
								<Button x:Name="ButtonAddOutputItem" Click="ButtonAddOutputItem_Click">
									<FontIcon Glyph="&#xE76C;"/>
								</Button>
								<!--
								Click : Runs ButtonRemoveOutputItem_Click, which moves any selected items to ViewModel.AvailableOutputOptions
								-->
								<Button x:Name="ButtonRemoveutputItem" Click="ButtonRemoveOutputItem_Click">
									<FontIcon Glyph="&#xE76B;"/>
								</Button>
							</StackPanel>
							
							<!--
							Source : Bound to ViewModel.SelectedOutputOptions, which is of type List<RxnOutputOptions>.
							-->
							<StackPanel Orientation="Vertical">
								<TextBlock Text="Selected outputs" Margin="5,0,0,0" Style="{ThemeResource SubtitleTextBlockStyle}"/>
								<muxc:InfoBar x:Name="InfoBarNoOutputsSelected" IsOpen="False" Severity="Warning" IsClosable="False"
								  Message="There are no outputs selected."/>
								<ListView x:Name="ListOutputItems_Right" Width="275"
										  ItemTemplate="{StaticResource ListOutputSelectionTemplate}"
										  ItemsSource="{x:Bind ViewModel.SelectedOutputOptions}"
										  CanDragItems="True" CanReorderItems="True" AllowDrop="True" SelectionMode="Extended">
								</ListView>
							</StackPanel>
						</StackPanel>
					</Border>
				</Popup>
				<Button Style="{StaticResource AccentButtonStyle}"  Margin="5" Click="RunCalc">
					<StackPanel Orientation="Horizontal">
						<SymbolIcon Symbol="Play" Margin="0,0,5,0"/>
						<TextBlock Text="Run calculation"/>
					</StackPanel>
				</Button>
			</StackPanel>
		</StackPanel>

		<StackPanel Grid.Row="0" Grid.Column="1">
			<!--
			Click : Runs ButtonAddSpecies_Click, which initializes a ControlRxnSpeciesViewModel and adds it to the ViewModel.
			-->
			<Button x:Name="ButtonAddSpecies" Click="ButtonAddSpecies_Click" Margin="5"
					Grid.Row="1" Grid.Column="0" Width="135"
					HorizontalAlignment="Left" VerticalAlignment="Top">
				<StackPanel Orientation="Horizontal">
					<SymbolIcon Symbol="Add" Margin="0,0,5,0"/>
					<TextBlock Text="Add species"/>
				</StackPanel>
			</Button>

			<ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto" MaxHeight="355" HorizontalAlignment="Left">
				<StackPanel Visibility="Visible" HorizontalAlignment="Left" Padding="0,0,0,0">
					<muxc:InfoBar x:Name="InfoBarNoRxnSpecies" IsOpen="False" Severity="Warning" IsClosable="False"
								  Message="There are no chemical species present in this reaction. Click 'Add species' to create one."/>
					<ListView Width="625" SelectionMode="None" HorizontalContentAlignment="Center" ItemsSource="{x:Bind ViewModel.Items}">
						<!--
						Initialize : Bound to ViewModel (type ControlRxnViewModel) which stores a list of ControlRxnSpeciesViewModels.
						Selection  : Bound to the ViewModel.
						-->
						<ListView.ItemTemplate>
							<DataTemplate x:DataType="vm:ControlRxnSpeciesViewModel">
								<local:ControlRxnSpecies Padding="0" ViewModel="{x:Bind Mode=TwoWay}"/>
							</DataTemplate>
						</ListView.ItemTemplate>
						<ListView.ItemContainerTransitions>
							<TransitionCollection>
								<AddDeleteThemeTransition/>
							</TransitionCollection>
						</ListView.ItemContainerTransitions>
					</ListView>

				</StackPanel>
			</ScrollViewer>
		</StackPanel>

		<Rectangle Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2" Margin="5"
				   Height="1" Fill="{StaticResource SystemAccentColor}"/>

		<StackPanel Grid.Row="2" Grid.Column="0" Margin="5">
			<TextBlock Style="{StaticResource SubtitleTextBlockStyle}" Text="Output"/>
			<TextBlock x:Name="DataLabel"/>
		</StackPanel>

		<oxy:PlotView x:Name="PlotViewKin" Grid.Row="2" Grid.Column="1" Margin="5" Background="Transparent"/>

	</Grid>

</Page>
