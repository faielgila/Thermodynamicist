<UserControl
	x:Class="ThermodynamicistUWP.OutputOptionsButton"
	xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
	xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
	xmlns:local="using:ThermodynamicistUWP"
	xmlns:vm="using:Core.ViewModels"
	xmlns:muxc="using:Microsoft.UI.Xaml.Controls"
	xmlns:animate="using:Microsoft.UI.Xaml.Controls.AnimatedVisuals"
	xmlns:ui="using:CommunityToolkit.WinUI"
	xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
	xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
	mc:Ignorable="d">

	<UserControl.Resources>
		<ResourceDictionary>
			<DataTemplate x:Key="ListOutputSelectionTemplate" x:DataType="vm:OutputItem">
				<ListViewItem AutomationProperties.Name="{x:Bind DisplayName}">
					<StackPanel Orientation="Horizontal">
						<FontIcon Width="20" Glyph="{x:Bind Glyph}"/>
						<TextBlock Text="{x:Bind DisplayName}" Margin="5"/>
					</StackPanel>
				</ListViewItem>
			</DataTemplate>
			<Style x:Key="DefaultOutputButtonStyle" TargetType="Button" BasedOn="{StaticResource DefaultButtonStyle}">
				<Setter Property="Background" Value="{StaticResource SystemAccentColor}"/>
				<Setter Property="Foreground" Value="{StaticResource TextFillColorPrimaryBrush}"/>
				<Setter Property="Margin" Value="0,5,0,0"/>
				<Setter Property="CornerRadius" Value="4,0,0,4"/>
				<Setter Property="Height" Value="33"/>
			</Style>
			<Style x:Key="WarningOutputButtonStyle" TargetType="Button" BasedOn="{StaticResource DefaultOutputButtonStyle}">
				<Setter Property="Background" Value="{StaticResource SystemFillColorCautionBackgroundBrush}"/>
				<Setter Property="Foreground" Value="{StaticResource SystemFillColorCautionBrush}"/>
				<Setter Property="BorderBrush" Value="{StaticResource SystemFillColorCautionBrush}"/>
				<Setter Property="BorderThickness" Value="1"/>
			</Style>
		</ResourceDictionary>
	</UserControl.Resources>

	<Grid HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Grid.Column="0">
		<Button x:Name="ButtonSelectOutputItems" Style="{ThemeResource DefaultOutputButtonStyle}" Click="ButtonSelectOutputItems_Click">
			<muxc:AnimatedIcon x:Name="AniIconButtonSelectOutputItems" HorizontalAlignment="Center" VerticalAlignment="Center" Height="20">
				<muxc:AnimatedIcon.Source>
					<animate:AnimatedSettingsVisualSource/>
				</muxc:AnimatedIcon.Source>
				<muxc:AnimatedIcon.FallbackIconSource>
					<muxc:SymbolIconSource Symbol="Setting"/>
				</muxc:AnimatedIcon.FallbackIconSource>
			</muxc:AnimatedIcon>
		</Button>
		<muxc:InfoBadge x:Name="InfoBadgeSelectOutputItems" Style="{StaticResource CautionIconInfoBadgeStyle}"
						HorizontalAlignment="Right" VerticalAlignment="Top"
						Visibility="Visible">
			<muxc:InfoBadge.RenderTransform>
				<TranslateTransform X="8"/>
			</muxc:InfoBadge.RenderTransform>
		</muxc:InfoBadge>

		<Popup x:Name="PopupSelectOutputItems" IsLightDismissEnabled="True" Width="Auto" Grid.Column="1" VerticalOffset="42"
			   Closed="PopupSelectOutputItems_Closed">
			<Popup.ChildTransitions>
				<TransitionCollection>
					<PopupThemeTransition/>
				</TransitionCollection>
			</Popup.ChildTransitions>
			<Grid Padding="15" CornerRadius="{StaticResource OverlayCornerRadius}"
				  BorderThickness="1" BorderBrush="{ThemeResource SurfaceStrokeColorDefaultBrush}"
				  Background="{ThemeResource AcrylicBackgroundFillColorDefaultBrush}">
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="300"/>
					<ColumnDefinition/>
					<ColumnDefinition Width="300"/>
				</Grid.ColumnDefinitions>

				<!--
				Source : Bound to AvailableOutputOptions, which is of type List<OutputItems>.
				-->
				<StackPanel Orientation="Vertical" Grid.Column="0">
					<TextBlock Text="Available outputs" Style="{ThemeResource SubtitleTextBlockStyle}"/>
					<TextBlock x:Name="TextNoOutputsAvailable"
							   Style="{ThemeResource WarningCaptionTextBlockStyle}"/>
					<ListView x:Name="ListOutputItems_Left" Margin="-5,0,0,0" HorizontalAlignment="Left"
							  ItemTemplate="{StaticResource ListOutputSelectionTemplate}"
							  ItemsSource="{x:Bind ViewModel.AvailableOutputOptions, Mode=TwoWay}"
							  CanDragItems="True" CanReorderItems="True" AllowDrop="True" SelectionMode="Multiple"/>

				</StackPanel>

				<Grid Grid.Column="1" Grid.Row="1" RowSpacing="5" Margin="0,0,5,0">
					<Grid.RowDefinitions>
						<RowDefinition/>
						<RowDefinition/>
					</Grid.RowDefinitions>

					<!--
					Click : Runs ButtonAddOutputItem_Click, which moves any selected items to ViewModel.SelectedOutputOptions
					-->
					<Button x:Name="ButtonAddOutputItem" Click="ButtonAddOutputItem_Click" Grid.Row="0" VerticalAlignment="Bottom">
						<FontIcon Glyph="&#xE76C;"/>
					</Button>
					<!--
					Click : Runs ButtonRemoveOutputItem_Click, which moves any selected items to ViewModel.AvailableOutputOptions
					-->
					<Button x:Name="ButtonRemoveutputItem" Click="ButtonRemoveOutputItem_Click" Grid.Row="1" VerticalAlignment="Top">
						<FontIcon Glyph="&#xE76B;"/>
					</Button>
				</Grid>

				<!--
				Source : Bound to SelectedOutputOptions, which is of type List<OutputItems>.
				-->
				<StackPanel Orientation="Vertical" Grid.Column="2" Margin="5,0,0,0">
					<TextBlock Text="Selected outputs" Style="{ThemeResource SubtitleTextBlockStyle}"/>
					<TextBlock x:Name="TextNoOutputsSelected" Style="{ThemeResource WarningCaptionTextBlockStyle}"/>
					<ListView x:Name="ListOutputItems_Right" Margin="-5,0,0,0"
							  ItemTemplate="{StaticResource ListOutputSelectionTemplate}"
							  ItemsSource="{x:Bind ViewModel.SelectedOutputOptions}"
							  CanDragItems="True" CanReorderItems="True" AllowDrop="True" SelectionMode="Multiple"/>
				</StackPanel>
			</Grid>
		</Popup>
	</Grid>

</UserControl>
